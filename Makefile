BINS	= radix-vulnerability-scanner-api
.PHONY: build
build: $(BINS)

.PHONY: test
test:
	go test -cover `go list ./...`


.PHONY: generate-radix-api-client
generate-radix-api-client:
	swagger generate client -t ./radix_api/generated_client -f https://api.radix.equinor.com/swaggerui/swagger.json -A RadixApi

# This make command is only needed for local testing now
# we also do make swagger inside Dockerfile
# swagger generate spec -o ./swagger.json --scan-models
.PHONY: swagger
swagger:
	rm -f ./swaggerui_src/swagger.json ./swaggerui/statik.go
	swagger generate spec -o ./swagger.json -m -x=github.com/equinor/radix-vulnerability-scanner-api/radix_api/generated_client/models
	mv swagger.json ./swaggerui_src/swagger.json
	statik -src=./swaggerui_src/ -p swaggerui

.PHONY: mocks
mocks:
	mockgen -source ./api/vulnerability/handler.go -destination ./api/vulnerability/mock/handler.go -package mock
	mockgen -source ./repository/repository.go -destination ./repository/mock/repository.go -package mock
	mockgen -source ./service/radixapi.go -destination ./service/mock/radixapi.go -package mock
	mockgen -source ./radix_api/generated_client/client/environment/environment_client.go -destination ./radix_api/mock_client/client/environment/environment_client.go -package environmentmock
	mockgen -source ./router/authorization.go -destination ./router/mock/authorization.go -package mock

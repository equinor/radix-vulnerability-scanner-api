{
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "schemes": [
    "http",
    "https"
  ],
  "swagger": "2.0",
  "info": {
    "description": "This is the vulnerability scan API Server for the Radix platform.",
    "title": "classification Radix API.",
    "contact": {
      "url": "https://equinor.slack.com/messages/CBKM6N2JY"
    },
    "version": "1.0.0"
  },
  "basePath": "/api/v1",
  "paths": {
    "/applications/vulnerabilities/{appName}": {
      "get": {
        "tags": [
          "vulnerability"
        ],
        "summary": "Gets vulnerability summaries for components and jobs in an application",
        "operationId": "getApplicationVulnerabilitySummaries",
        "parameters": [
          {
            "type": "string",
            "description": "Name of the application",
            "name": "appName",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Successful get vulnerability summaries for application",
            "schema": {
              "$ref": "#/definitions/ApplicationVulnerabilities"
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    },
    "/applications/{appName}/environments/{envName}": {
      "get": {
        "tags": [
          "vulnerability"
        ],
        "summary": "Gets vulnerability summary for components in an environment",
        "operationId": "getEnvironmentVulnerabilitySummary",
        "parameters": [
          {
            "type": "string",
            "description": "Name of the application",
            "name": "appName",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "Name of the environment",
            "name": "envName",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Successful get vulnerability summary for application",
            "schema": {
              "$ref": "#/definitions/EnvironmentVulnerabilities"
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    },
    "/applications/{appName}/environments/{envName}/jobs/{jobName}": {
      "get": {
        "tags": [
          "vulnerability"
        ],
        "summary": "Gets vulnerability summary for job in an environment",
        "operationId": "getJobVulnerabilities",
        "parameters": [
          {
            "type": "string",
            "description": "Name of the application",
            "name": "appName",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "Name of the environment",
            "name": "envName",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "Name of the job",
            "name": "jobName",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Successful get vulnerabilities for a job",
            "schema": {
              "$ref": "#/definitions/ImageWithLastScan"
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    }
  },
  "definitions": {
    "ApplicationVulnerabilities": {
      "description": "ApplicationVulnerabilities holds vulnerability scan summaries for an application",
      "type": "array",
      "items": {
        "$ref": "#/definitions/EnvironmentVulnerabilities"
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "ComponentVulnerabilities": {
      "description": "ComponentVulnerabilities defines a map where key is component or job name and value is a summary of vulnerabilities",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ImageWithLastScan"
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "EnvironmentVulnerabilities": {
      "description": "EnvironmentVulnerabilities holds vulnerability scan summaries for components and jobs",
      "type": "object",
      "required": [
        "name"
      ],
      "properties": {
        "components": {
          "$ref": "#/definitions/ComponentVulnerabilities"
        },
        "jobs": {
          "$ref": "#/definitions/ComponentVulnerabilities"
        },
        "name": {
          "description": "Name of environment",
          "type": "string",
          "x-go-name": "Name",
          "example": "dev"
        }
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "Image": {
      "description": "Image holds name of image the base image",
      "type": "object",
      "required": [
        "image"
      ],
      "properties": {
        "baseImage": {
          "description": "Base image",
          "type": "string",
          "x-go-name": "BaseImage",
          "example": "alpine:3.13.2"
        },
        "image": {
          "description": "Name of image",
          "type": "string",
          "x-go-name": "ImageName",
          "example": "quay.io/oauth2-proxy/oauth2-proxy:v7.1.3"
        }
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "ImageScan": {
      "description": "ImageScan holdes information about a spcific vulnerability scan for an image",
      "type": "object",
      "required": [
        "scanTime",
        "scanSuccess"
      ],
      "properties": {
        "scanSuccess": {
          "description": "Flag indicating if scan succeeded or not",
          "type": "boolean",
          "x-go-name": "ScanSuccess",
          "example": true
        },
        "scanTime": {
          "description": "Date and time of scan",
          "type": "string",
          "format": "date-time",
          "x-go-name": "ScanTime",
          "example": "2022-05-05T14:26:45+02:00"
        },
        "vulnerabilities": {
          "description": "List of vulnerabilities",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Vulnerability"
          },
          "x-go-name": "Vulnerabilities"
        },
        "vulnerabilitySummary": {
          "description": "Count of vulnerabilities grouped by severity",
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "format": "int64"
          },
          "x-go-name": "VulnerabilitySummary"
        }
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "ImageWithLastScan": {
      "description": "ImageWithLastScan holds information about vulnerabilities found in the last scan for an image",
      "allOf": [
        {
          "$ref": "#/definitions/Image"
        },
        {
          "$ref": "#/definitions/ImageScan"
        }
      ],
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    },
    "Vulnerability": {
      "description": "Vulnerability holds detailed information about a vulnerability",
      "type": "object",
      "required": [
        "packageName",
        "version",
        "severity"
      ],
      "properties": {
        "cve": {
          "description": "A list of CVEs referencing the vulnerability",
          "type": "array",
          "items": {
            "type": "string"
          },
          "x-go-name": "CVE",
          "example": [
            "CVE-2019-18276"
          ]
        },
        "cvss": {
          "description": "The CVSS value of the vulnerability",
          "type": "number",
          "format": "float",
          "x-go-name": "CVSS",
          "example": 7.8
        },
        "cwe": {
          "description": "A list of CWEs referencing the vulnerability",
          "type": "array",
          "items": {
            "type": "string"
          },
          "x-go-name": "CWE",
          "example": [
            "CWE-273"
          ]
        },
        "description": {
          "description": "A detailed description of the vulnerability",
          "type": "string",
          "x-go-name": "Description",
          "example": "An issue was discovered in disable_priv_mode in shell.c in GNU Bash through 5.0 patch 11. By default, if Bash is run with its effective UID not equal to its real UID..."
        },
        "packageName": {
          "description": "Name of the vulnerabile package",
          "type": "string",
          "x-go-name": "PackageName",
          "example": "bash"
        },
        "publishedDate": {
          "description": "The date the vulnerability was published",
          "type": "string",
          "format": "date-time",
          "x-go-name": "PublishedDate",
          "example": "2021-03-26T17:15:00Z"
        },
        "references": {
          "description": "A list of URLs with more information about the vulnerability",
          "type": "array",
          "items": {
            "type": "string"
          },
          "x-go-name": "References",
          "example": [
            "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-18276",
            "https://github.com/bminor/bash/commit/951bdaad7a18cc0dc1036bba86b18b90874d39ff"
          ]
        },
        "severity": {
          "description": "The severity of the vulnerability",
          "type": "string",
          "enum": [
            "CRITICAL",
            "HIGH",
            "MEDIUM",
            "LOW",
            "UNKNOWN"
          ],
          "x-go-name": "Severity",
          "example": "HIGH"
        },
        "title": {
          "description": "Title of the vulnerability",
          "type": "string",
          "x-go-name": "Title",
          "example": "bash: when effective UID is not equal to its real UID the saved UID is not dropped"
        },
        "version": {
          "description": "Version of the affected package",
          "type": "string",
          "x-go-name": "Version",
          "example": "5.0-4"
        }
      },
      "x-go-package": "github.com/equinor/radix-vulnerability-scanner-api/api/models"
    }
  },
  "securityDefinitions": {
    "bearer": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header"
    }
  },
  "security": [
    {
      "bearer": []
    }
  ]
}